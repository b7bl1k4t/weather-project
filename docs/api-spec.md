# API практической работы №4

Интерфейс добавлен поверх существующего веб-приложения погоды. Бекенд реализован на PHP и работает с базой PostgreSQL. Базовый URL внутри docker-compose окружения:

```
http://localhost/api/<endpoint>.php
```

Запросы/ответы — JSON (`Content-Type: application/json; charset=utf-8`). Ошибки возвращаются в формате:

```json
{
  "error": "Сообщение об ошибке"
}
```

## Сущности

1. `weather_data` — оперативные данные о погоде, использующиеся на публичной странице сайта.
2. `users` — администраторы, имеющие доступ к панели управления.

## Endpoints: Weather

| Метод | URL | Описание |
|-------|-----|----------|
| `GET` | `/api/weather.php?limit=10` | Список записей (по умолчанию до 20). |
| `GET` | `/api/weather.php?id=5` | Получение конкретной записи. |
| `POST` | `/api/weather.php` | Создание записи. |
| `PUT`/`PATCH` | `/api/weather.php?id=5` | Полное обновление записи. |
| `DELETE` | `/api/weather.php?id=5` | Удаление записи. |

### Пример создания записи

```
POST /api/weather.php
```

```json
{
  "temperature": 23.4,
  "humidity": 58,
  "pressure": 1011,
  "wind_speed": 4.2,
  "description": "Ясно",
  "icon": "☀️"
}
```

Успех → `201 Created` с JSON тела созданной записи. Все поля обязательны. Валидация проверяет числовые диапазоны и длины строк.

### Пример ответа списка

```json
{
  "data": [
    {
      "id": 7,
      "temperature": "23.40",
      "humidity": 58,
      "pressure": 1011,
      "wind_speed": "4.20",
      "description": "Ясно",
      "icon": "☀️",
      "created_at": "2024-03-17 10:15:00"
    }
  ]
}
```

### Коды ошибок

- `400` — отсутствует обязательный параметр `id`.
- `404` — запись не найдена.
- `422` — валидация данных (например, влажность за пределами 0–100).
- `500` — системная ошибка.

## Endpoints: Users

| Метод | URL | Описание |
|-------|-----|----------|
| `GET` | `/api/users.php?limit=10` | Список пользователей. Пароли не возвращаются. |
| `GET` | `/api/users.php?id=3` | Данные пользователя. |
| `POST` | `/api/users.php` | Создание пользователя. |
| `PUT`/`PATCH` | `/api/users.php?id=3` | Обновление. Можно передавать только изменяемые поля. |
| `DELETE` | `/api/users.php?id=3` | Удаление пользователя. |

### Пример создания пользователя

```json
{
  "username": "editor",
  "password": "secret123",
  "email": "editor@example.com"
}
```

Ответ `201 Created`:

```json
{
  "data": {
    "id": 4,
    "username": "editor",
    "email": "editor@example.com",
    "created_at": "2024-03-17 11:02:15"
  }
}
```

### Правила

- `username` — 3..50 символов, уникален.
- `password` — минимум 6 символов, хранится как bcrypt-хэш.
- `email` — опционален, но проверяется на корректность, если указан.
- При `PUT/PATCH` достаточно передать изменяемые поля; пустой запрос вернёт `422`.

### Ошибки

- `409 Conflict` — попытка создать/обновить пользователя с уже существующим `username`.
- Остальные коды аналогичны погодному API.

## Тестирование через Postman

1. Создайте коллекцию с запросами из таблиц выше. Базовый URL: `http://localhost`.
2. Для методов `POST/PUT/PATCH` укажите `Content-Type: application/json` и передайте тело запроса, как в примерах.
3. Проверьте CRUD-сценарии:
   - создание записи → чтение → обновление → удаление;
   - обработка ошибок (например, удалить несуществующий идентификатор).
4. При необходимости можно сохранить токен авторизации панели админа, но API работает без аутентификации (по требованию работы №4).

Документ вместе с выводом Postman формирует отчёт о спецификации и тестировании API.
